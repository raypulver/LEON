(function(){"use strict";function t(t){return function(){return Function.call.apply(t,arguments)}}function e(t){var e=k(null);return t&&z(P(t),function(r){e[r]=t[r]}),e}function r(t){for(var e=P(J),r=0;r<e.length;++r)if(J[e[r]]===t)return e[r];throw TypeError(B(t)+" is not a valid type.")}function n(t){if("object"!=typeof t)throw TypeError("Argument must be an object");var e=function(r){return z(P(r),function(t){this[t]=r[t]},t),e};return e}function s(t,e){return e>=32?-t:((1<<e)-1^t)+1}var h,u,a,f=this,o=f.LEON,c=65536,l=1,d=0,p=2,w=4,b=6,g=7,I=3,v=5,y=128,E=9,U=16,L=17,N=32,V=33,S=64,M=20,A=21,m=22,D=23,T=24,j=25,O=26,_=221,F=Object,C=F.prototype,R=Array,x=R.prototype,B=String,W=String.fromCharCode,G=f.toString||C.toString,Y=R.isArray||function(t){return"[object Array]"===G.call(t)},k=F.create||function(t){function e(){}return e.prototype=t,new e},P=F.keys||function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e},H=F.getOwnPropertyNames||P,X=t(x.reduce||function(t,e,r){for(var n=0;n<this.length;++n)e=t.call(r,e,this[n],n,this)}),z=t(x.forEach),J=e({CHAR:l|d,UNSIGNED_CHAR:d,SHORT:l|p,UNSIGNED_SHORT:p,INT:l|w,UNSIGNED_INT:w,FLOAT:b,DOUBLE:g,STRING:U,UTF16STRING:L,BOOLEAN:N&V,NULL:S,UNDEFINED:M,DATE:A,NAN:T,BUFFER:m,REGEXP:D,MINUS_INFINITY:O,INFINITY:j,DYNAMIC:_});if(a=function(){try{return new Uint8Array(4),!0}catch(t){return h=!1,u=null,!1}}()){var q=Uint8Array,K=ArrayBuffer,Q=new K(4),Z=new q(Q),$=new Float32Array(Q),tt=new K(8),et=new q(tt),rt=new Float64Array(tt);if(h=function(){try{return new Buffer(4),!0}catch(t){return!1}}())var nt=Buffer,it=nt.isBuffer;u=function(){var t=new K(2),e=new q(t),r=new Uint16Array(t);return r[0]=1,!!e[0]}()}var st=function(){function t(e){return this instanceof t?(this.buffer=e,this.i=0,void wt.call(this)):new t(e)}function e(r,n){return this instanceof e?(this.buffer=t(r),this.state=0,this.spec=n,void bt.call(this)):new e(r,n)}function f(t,e){var r,n=typeof t;switch(n){case"object":if(null===t)return S;if(Y(t))return y;switch(r=G.call(t)){case"[object Date]":return A;case"[object RegExp]":return D;default:return gt(t)?m:E}case"boolean":return t?N:V;case"string":for(var i=0;i<t.length;++i)if(t.charCodeAt(i)>255)return L;return U;case"number":return t!==t?T:t===Number.NEGATIVE_INFINITY?O:t===Number.POSITIVE_INFINITY?j:t%1||e?It(t):0>t?Math.abs(t)<=128?l|d:Math.abs(t)<=32768?l|p:Math.abs(t)<=Math.pow(2,31)?l|w:g:256>t?d:65536>t?p:t<Math.pow(2,32)?w:g;case"undefined":case"function":return M}}function F(t,e){return this instanceof F?(this.payload=t,this.buffer=pt(),this.spec=e,this.state=0,this.i=0,void yt.call(this)):new F(t,e)}function C(t){return t=t.toString(),[t.substr(1,t.lastIndexOf("/")-1),t.substr(t.lastIndexOf("/")+1)]}function R(t){var e=f(t[0]);switch(e){case d:case l:case p:case I:case w:case v:case b:case g:for(var r=Math.abs(t[0]),n=t[0]%1!==0,i=t[0]<0?1:0,s=1;s<t.length;++s){if("number"!=typeof t[s])return _;Math.abs(t[s])>r&&(r=Math.abs(t[s])),t[s]%1!==0&&(n=!0),t[s]<0&&(i=1)}return f((i?-1:1)*r,n);case y:return[R(X(t,function(t,e){return t.concat(e)},[]))];case E:var h={};return z(H(t[0]),function(e){h[e]=R(x(t,e))}),h;default:e===V&&(e=N);for(var u,s=1;s<t.length;++s)if(u=f(t[s]),u===V&&(u=N),u!==e)return _;return e}}function x(t,e){for(var r=[],n=0;n<t.length;++n){if("object"!=typeof t[n])throw Error("Received a non-object value when an object was expected.");if("undefined"==typeof t[n][e])throw Error("Object "+JSON.stringify(t[n])+" has no property "+B(e)+".");r.push(t[n][e])}return r}function k(t){var e=f(t);switch(e){case y:return[R(t)];case E:var r={};return z(H(t),function(e){r[e]=k(t[e])}),r;case V:return N;default:return e}}function Q(t,r){return e(pt(t)).parseValue()}function tt(t,e){return F(t).writeData().toBuffer()}function st(t){return/^[0-9]/.test(t)||/[^\w_]/.test(t)?!0:!1}function ht(t,e){for(var r=0,n=H(t);r<n.length;++r)if(t[n[r]]===e)return!0;return!1}function ut(t,e){var r;switch("undefined"==typeof e&&(e="{Template}"),typeof t){case"number":if(!ht(J,t))throw Error(e+" is not a valid type constant.");break;case"function":throw Error(e+" is a function.");case"boolean":throw Error(e+" is a boolean.");case"undefined":throw Error(e+" is undefined. Did you misspell a type constant?");case"string":throw Error(e+" is a string.");case"object":if("[object Date]"===G.call(t))throw Error(e+" is a Date object. Did you mean to supply LEON.DATE?");if("[object RegExp]"===G.call(t))throw Error(e+" is a RegExp. Did you mean to supply LEON.REGEXP?");if(Y(t)){if(0===t.length)throw Error(e+" is an array with no elements, must have one.");if(t.length>1)throw Error(e+" is an array with more than one element. If you want to serialize an array of various types you must use LEON.DYNAMIC.");ut(t[0],e+"[0]")}else for(var n=0,i=H(t);n<i.length;++n)r=st(t),ut(t[i[n]],e+(r?"['"+i[n]+"']":"."+i[n]))}}function at(t){return this instanceof at?(ut(t),this.spec=t,void(this.sorted=function e(t){if("object"==typeof t){if(Y(t)){var r=[];return r.push(e(t[0])),r}var r=[],n=H(t);n.sort(function(t,e){return t>e});for(var i=0;i<n.length;++i)r.push(n[i]),r.push(e(t[n[i]]));return r.object=!0,r}return t}(t))):new at(t)}function ft(t,e){for(var r="",n=0;e>n;++n)r+=t;return r}function ot(t,e){return st(t)?(e?"[32m":"")+"'"+t+"'"+(e?"[m":""):t}var ct=function(){var t;return t=a?function(t){"undefined"==typeof t&&(t=this.buffer.byteLength<<1);var e=this.buffer;this.buffer=new K(t);var r=new q(e),n=new q(this.buffer);return n.set(r,0),this.uchars=new q(this.buffer),this.chars=new Int8Array(this.buffer),this}:function(t){return void 0===t&&(t=this.buffer.length<<1),this.buffer.length=t,this},function(){this._realloc=t}}(),lt=function(){function t(t,e){return 0>t&&(t=s(-t,16)),this.writeUInt16LE(t,e)}function e(t,e){return 0>t&&(t=s(-t,32)),this.writeUInt32LE(t,e)}function r(t){return this.uchars[t]}function n(t){return this.uchars[t+1]<<8|this.uchars[t]}function i(t){var e=this.readUInt16LE(t);return 32768&e?-s(e,16):e}function h(t){return this.uchars[t+3]<<24|this.uchars[t+2]<<16|this.uchars[t+1]<<8|this.uchars[t]}function f(t){var e=this.readUInt32LE(t);return 0>e?e:2147483648&e?-s(e,32):e}var o,c,l,d,p,w,b,g,I;return a?(d=function(t,e){return e>=this.buffer.byteLength&&this._realloc(),this.uchars[e]=t,this},o=function(t,e){return e>=this.buffer.byteLength&&this._realloc(),this.chars[e]=t,this},p=function(t,e){return e>=this.buffer.byteLength-1&&this._realloc(),this.uchars[e]=255&t,this.uchars[e+1]=t>>>8,this},w=function(t,e){return e>=this.buffer.byteLength-3&&this._realloc(),this.uchars[e]=255&t,this.uchars[e+1]=t>>>8&255,this.uchars[e+2]=t>>>16&255,this.uchars[e+3]=t>>>24,this},b=function(t){return this.chars[t]},u?(c=function(t,e){return e>=this.buffer.byteLength-3&&this._realloc(),$[0]=t,this.uchars.set(Z,e),this},l=function(t,e){return e>=this.buffer.byteLength-7&&this._realloc(),rt[0]=t,this.uchars.set(et,e),this},g=function(t){for(var e=0;e<Z.length;++e)Z[e]=this.uchars[t+e];return $[0]},I=function(t){for(var e=0;e<et.length;++e)et[e]=this.uchars[t+e];return rt[0]}):(c=function(t,e){e>=this.buffer.byteLength-3&&this._realloc(),$[0]=t;for(var r=Z.length-1;r>=0;--r)this.uchars[e+(Z.length-1-r)]=Z[r];return this},l=function(t,e){e>=this.buffer.byteLength-7&&this._realloc(),rt[0]=t;for(var r=et.length-1;r>=0;--r)this.uchars[e+(et.length-1-r)]=et[r];return this},g=function(t){for(var e=Z.length-1;e>=0;--e)Z[Z.length-1-e]=this.uchars[t+e];return $[0]},I=function(t){for(var e=et.length-1;e>=0;--e)et[et.length-1-e]=this.uchars[t+e];return rt[0]})):(d=function(t,e){return e>=this.uchars.length&&this._realloc(),this.uchars[e]=t,this},o=function(t,e){0>t&&(t=s(-t,8)),this.writeUInt8(t,e)},p=function(t,e){return e>=this.uchars.length-1&&this._realloc(),this.uchars[e]=255&t,this.uchars[e+1]=t>>>8,this},w=function(t,e){return e>=this.uchars.length-3&&this._realloc(),this.uchars[e]=255&t,this.uchars[e+1]=t>>>8&255,this.uchars[e+2]=t>>>16&255,this.uchars[e+3]=t>>>24,this},c=function(t,e){var r,n,i=127,s=[];r=0>t?1:0,t=Math.abs(t),n=Math.log(t)/Math.LN2,n=0>n?Math.ceil(n):Math.floor(n),t*=Math.pow(2,-n+23),i+=n,t=Math.round(t),t&=8388607,s.push(r<<7),s[0]|=(254&i)>>1,s.push((1&i)<<7),s[1]|=t>>16&127,s.push(t>>8&255),s.push(255&t);for(var h=3;h>=0;--h)this.writeUInt8(s[h],e+(3-h));return e+4},l=function(t,e){var r,n,i=1023;r=0>t?1:0,t=Math.abs(t),n=Math.log(t)/Math.LN2,n=0>n?Math.ceil(n):Math.floor(n),t*=Math.pow(2,-n+52),i+=n,t=Math.round(t),t=parseInt(t.toString(2).substr(1),2);var s=[];s.push(r<<7),s[0]|=i>>4,s.push((15&i)<<4),s[1]|=15&Math.floor(t*Math.pow(2,-48));for(var h=40,u=0;6>u;++u)s.push(255&Math.floor(t*Math.pow(2,-h))),h-=8;for(u=7;u>=0;--u)this.writeUInt8(s[u],e+(7-u));return e+8},b=function(t){var e=this.uchars[t];return 128&e?-s(e,8):e},g=function(t){for(var e=[],r=3;r>=0;--r)e.push(this.readUInt8(t+r));var n=(128&e[0])>>7,i=(127&e[0])<<1|(128&e[1])>>7,s=0;e[1]&=127;for(var r=0;2>=r;++r)s|=e[r+1]*Math.pow(2,8*(2-r));return s|=8388608,(1===n?-s:s)*Math.pow(2,i-150)},I=function(t){for(var e=[],r=7;r>=0;--r)e.push(this.readUInt8(t+r));var n=(128&e[0])>>7,i=(127&e[0])<<4|(240&e[1])>>4,s=0;e[1]&=15;for(var r=0;6>=r;++r)s+=e[r+1]*Math.pow(2,8*(6-r));return s+=4503599627370496,(1===n?-s:s)*Math.pow(2,i-1075)}),function(){this.writeUInt8=d,this.writeInt8=o,this.writeUInt16LE=p,this.writeInt16LE=t,this.writeUInt32LE=w,this.writeInt32LE=e,this.writeFloatLE=c,this.writeDoubleLE=l,this.readUInt8=r,this.readInt8=b,this.readUInt16LE=n,this.readInt16LE=i,this.readUInt32LE=h,this.readInt32LE=f,this.readFloatLE=g,this.readDoubleLE=I}}(),dt=function(t,e){return a?t:e}(function(t){for(var e=new K(t.length),r=new q(e),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return e},function(t){for(var e=new Array(t.length),r=0;r<t.length;++r)e[r]=t.charCodeAt(r);return e}),pt=function(t,e,r){return h?t:a?e:r}(function Ut(t){if(!(this instanceof Ut))return new Ut(t);if("undefined"==typeof t&&(t=c),t instanceof K)this.buffer=t;else if("string"==typeof t)this.buffer=dt(t);else if(it(t)){var e=t;t=new K(e.length);for(var r=new q(t),n=0;n<e.length;++n)r[n]=e[n];this.buffer=t}else this.buffer=new K(t);this.uchars=new q(this.buffer),this.chars=new Int8Array(this.buffer),lt.call(this),ct.call(this)},function Lt(t){return this instanceof Lt?("undefined"==typeof t&&(t=c),this.buffer="string"==typeof t?dt(t):t instanceof K?t:new K(t),this.uchars=new q(this.buffer),this.chars=new Int8Array(this.buffer),lt.call(this),void ct.call(this)):new Lt(t)},function Nt(t){return this instanceof Nt?("undefined"==typeof t&&(t=c),this.buffer=Y(t)?t:"string"==typeof t?dt(t):new Array(t),this.uchars=this.buffer,lt.call(this),void ct.call(this)):new Nt(t)});pt.concat=function(t,e){return a?t:e}(function(t){return pt(X(t,function(t,e){var r=new q(t.buffer.byteLength+e.buffer.byteLength);return r.set(new q(t.buffer),0),r.set(new q(e.buffer),t.buffer.byteLength),r.buffer},new K(0)))},function(t){return pt(X(t,function(t,e){return t.concat(e.buffer)},[]))});var wt=function(){function t(){return this.i++,this.buffer.readUInt8(this.i-1)}function e(){return this.i++,this.buffer.readInt8(this.i-1)}function r(){return this.i+=2,this.buffer.readUInt16LE(this.i-2)}function n(){return this.i+=2,this.buffer.readInt16LE(this.i-2)}function i(){return this.i+=4,this.buffer.readUInt32LE(this.i-4)}function s(){return this.i+=4,this.buffer.readInt32LE(this.i-4)}function h(){return this.i+=4,this.buffer.readFloatLE(this.i-4)}function u(){return this.i+=8,this.buffer.readDoubleLE(this.i-8)}function a(t){return t===d?this.readUInt8():t===(d|l)?this.readInt8():t===p?this.readUInt16():t===(p|l)?this.readInt16():t===w?this.readUInt32():t===(w|l)?this.readInt32():t===b?this.readFloat():t===g?this.readDouble():void 0}return function(){this.readUInt8=t,this.readInt8=e,this.readUInt16=r,this.readInt16=n,this.readUInt32=i,this.readInt32=s,this.readFloat=h,this.readDouble=u,this.readValue=a}}(),bt=function(){function t(t){var e="",r=this.buffer.readUInt8(),n=this.buffer.readValue(r),i=0;if(t){for(;n>i;)e+=W(this.buffer.readUInt16()),++i;return e}for(;n>i;)e+=W(this.buffer.readUInt8()),++i;return e}function e(t){var e,r,n,i;if("undefined"==typeof t&&(t=this.spec),t===U)return e=this.readString();if(t===L)return e=this.readString(!0);if(t===_)return this.parseValue();if("object"!=typeof t)return t===(N&V)?this.parseValue():this.parseValue(t);if(Y(t)){if(0===t.length)return this.parseValue(y);if(t.object){for(e={},r=0;r<t.length;r+=2)e[t[r]]=this.parseValueWithSpec(t[r+1]);return e}for(t=t[0],i=this.buffer.readUInt8(),n=this.buffer.readValue(i),e=new Array(n),r=0;n>r;++r)e[r]=this.parseValueWithSpec(t);return e}}function r(t){"undefined"==typeof t&&(t=this.buffer.readUInt8());var e,r,n,i;if(E>t)return this.buffer.readValue(t);switch(t){case y:for(t=this.buffer.readUInt8(),e=this.buffer.readValue(t),n=new Array(e),r=0;e>r;++r)n[r]=this.parseValue();return n;case E:for(n={},e=this.buffer.readValue(this.buffer.readUInt8()),r=0;e>r;++r)i=this.readString(),n[i]=this.parseValue();break;case U:return this.readString();case L:return this.readString(!0);case M:return void 0;case N:return!0;case V:return!1;case S:return null;case T:return 0/0;case O:return Number.NEGATIVE_INFINITY;case j:return Number.POSITIVE_INFINITY;case A:return new Date(this.buffer.readValue(g));case m:if(e=this.buffer.readValue(this.buffer.readUInt8()),h)for(n=new nt(e),r=0;e>r;++r)n[r]=this.buffer.readUInt8();else{n=new K(e);var s=new q(n);for(r=0;e>r;++r)s[r]=this.buffer.readUInt8()}return n;case D:return RegExp(this.readString(),this.readString());default:throw Error("Invalid LEON.")}return n}return function(){this.parseValue=r,this.parseValueWithSpec=e,this.readString=t}}(),gt=function(t,e,r){return h?t:a?e:r}(function(t){return it(t)||t instanceof K?!0:!1},function(t){return t instanceof K?!0:!1},function(){return!1}),It=function(t,e){return a?t:e}(function(t){return $[0]=t,$[0]===t?b:g},function(t){t=Math.abs(t);var e=Math.log(t)/Math.LN2;e=0>e?Math.ceil(e):Math.floor(e);var r=103+e;return 0>r||r>255?g:(t*=Math.pow(2,-e+24),Math.floor(t)!==t?g:b)}),vt=function(t,e){return a?t:e}(function(t){var e,r="",n=0;for(t=t.buffer;n<t.byteLength;)e=new q(t,n,Math.min(8192,t.byteLength-n)),r+=W.apply(void 0,e),n+=8192;return r},function(t){for(var e="",r=0;r<t.length;++r)e+=W(t[r]);return e}),yt=function(){function t(){return"undefined"!=typeof this.spec?this.writeValueWithSpec(this.payload):this.writeValue(this.payload,f(this.payload)),this}function e(t,e){var r,n=typeof t;if(void 0===e&&(e=this.spec),"object"!=typeof e)e===_?this.writeValue(t,f(t)):e===(N&V)?this.writeValue(t,f(t),!0):this.writeValue(t,e,!0);else if(e.object){if("object"!==n)throw TypeError("Was expecting an object but instead got a "+n+".");for(r=0;r<e.length;r+=2)this.writeValueWithSpec(t[e[r]],e[r+1])}else{if(!Y(t))throw TypeError("Was expecting an array but instead got a "+n+".");for(this.writeValue(t.length,f(t.length)),r=0;r<t.length;++r)this.writeValueWithSpec(t[r],e[0])}}function r(t){return this.buffer.writeUInt8(t,this.i),this.i++,this}function n(t,e,r){var n,i,s;switch(e){case M:case N:case V:case S:case T:case O:case j:return this.appendUInt8(e),1;case L:return r||this.appendUInt8(e),void this.writeString(t,!0);case U:return r||this.appendUInt8(e),void this.writeString(t);case l:return r||this.appendUInt8(e),this.buffer.writeInt8(t,this.i),this.i++,2;case d:return r||this.appendUInt8(e),this.buffer.writeUInt8(t,this.i),this.i++,2;case I:return r||this.appendUInt8(e),this.buffer.writeInt16LE(t,this.i),this.i+=2,3;case p:return r||this.appendUInt8(e),this.buffer.writeUInt16LE(t,this.i),this.i+=2,3;case v:return r||this.appendUInt8(e),this.buffer.writeInt32LE(t,this.i),this.i+=4,5;case w:return r||this.appendUInt8(e),this.buffer.writeUInt32LE(t,this.i),this.i+=4,5;case b:return r||this.appendUInt8(e),this.buffer.writeFloatLE(t,this.i),this.i+=4,5;case g:return r||this.appendUInt8(e),this.buffer.writeDoubleLE(t,this.i),this.i+=8,9;case y:for(r||this.appendUInt8(e),this.writeValue(t.length,f(t.length)),n=0;n<t.length;++n)this.writeValue(t[n],f(t[n]));break;case E:for(r||this.appendUInt8(e),i=P(t),this.writeValue(i.length,f(i.length)),n=0;n<i.length;++n)this.writeString(i[n]),this.writeValue(t[i[n]],f(t[i[n]]));break;case A:r||this.appendUInt8(e),this.writeValue(t.valueOf(),g,!0);break;case m:r||this.appendUInt8(e),this.writeBuffer(t);break;case D:return r||this.appendUInt8(e),s=C(t),this.writeString(s[0]),this.writeString(s[1]),X(s,function(t,e){return t+e.length+1},0)}}function s(t,e){if(this.writeValue(t.length,f(t.length)),e)for(var r=0;r<t.length;++r)this.writeValue(t.charCodeAt(r),p,!0);else for(var r=0;r<t.length;++r)this.appendUInt8(t.charCodeAt(r))}var u,o;return h?(u=function(){for(var t=new nt(this.i),e=0;e<this.i;++e)t[e]=this.buffer.uchars[e];return t},o=function(t){var e,r;if(t instanceof K)for(e=new q(t),this.writeValue(e.length,f(e.length)),r=0;r<e.length;++r)this.writeValue(e[r],d,!0);else if(it(t))for(this.writeValue(t.length,f(t.length)),r=0;r<t.length;++r)this.writeValue(t[r],d,!0);else"string"==typeof t&&this.writeString(t)}):(u=function(){return vt(this.buffer.uchars)},o=a?function(t){var e;if(t instanceof K)for(e=new q(t),this.writeValue(e.length,f(e.length)),i=0;i<e.length;++i)this.writeValue(e[i],d,!0);else"string"==typeof t&&this.writeString(t)}:function(t){this.writeString(t)}),function(){this.writeData=t,this.writeBuffer=o,this.toBuffer=u,this.writeValueWithSpec=e,this.writeValue=n,this.appendUInt8=r,this.writeString=s}}();at.prototype={inspect:function(t,e,n,i,s,h){var u="",a=!1;"undefined"==typeof e&&(e={colors:!1}),"undefined"==typeof h&&(h={}),"undefined"==typeof s&&(u+="{[Channel] ",s=!1,a=!0);var f,o;if("undefined"==typeof n&&(i=0),"undefined"==typeof n&&(n=this.spec),"object"==typeof n)if(Y(n))u+="["+this.inspect(t,e,n[0],i,s,h)+"]";else{for(h.flag=!0,u+="{\n",f=H(n),o=0;o<f.length;++o)u+=ft("  ",i+1)+ot(f[o],e.colors)+": "+this.inspect(t,e,n[f[o]],i+1,s,h)+(f.length-1===o?"":",")+"\n";u+=ft("  ",i)+"}"}else u+=r(n);return a&&(u+="}"),u},encode:function(t){return F(t,this.sorted).writeData().toBuffer()},decode:function(t){return e(pt(t),this.sorted).parseValueWithSpec()}};var Et={};return n(Et)(J),Et.decode=Q,Et.encode=tt,Et.toTemplate=k,Et.Channel=at,Et.noConflict=function(){return o},Et}();"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=st):f.LEON=st}).call(this);